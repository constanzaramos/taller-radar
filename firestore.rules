rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Reglas para la colección de workshops
    match /workshops/{workshopId} {
      // Permitir lectura pública de todos los workshops
      allow read: if true;
      
      // Permitir escritura pública para crear nuevos workshops (solo pendientes)
      // Con validaciones básicas de seguridad
      allow create: if (
          // Si el usuario NO está autenticado, solo puede crear pendientes
          (request.auth == null 
            && request.resource.data.status == 'pending'
            && request.resource.data.approved == false)
          // Si el usuario está autenticado, puede crear aprobados o pendientes
          || (request.auth != null)
        )
        && request.resource.data.keys().hasAll([
          'name',
          'category',
          'modality',
          'date',
          'time',
          'description',
          'status',
          'approved',
          'createdAt'
        ])
        && request.resource.data.name is string
        && request.resource.data.name.size() > 0
        && request.resource.data.description is string
        && request.resource.data.description.size() > 0;
      
      // Permitir actualización solo a usuarios autenticados
      // Pueden actualizar cualquier campo (incluyendo status y approved para moderación)
      allow update: if request.auth != null;
      
      // No permitir eliminación desde el cliente
      allow delete: if false;
    }
    
    // Permitir lectura de otras colecciones si existen
    match /{document=**} {
      allow read: if true;
      allow write: if false;
    }
  }
}

